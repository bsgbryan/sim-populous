(function(){angular.module("simgame",["ngAnimate","ngCookies","ngTouch","ngSanitize","ui.router","ui.bootstrap"])}).call(this),function(){var e,l;e={residential:4,commercial:7,industrial:7},l={residential:2,commercial:4,industrial:3},angular.module("simgame").controller("MainController",["$scope","$interval",function(i,a){var n,o,t,r,s,c,d;for(i.creating={residential:!1,commercial:!1,industrial:!1,education:!1,"public":!1},i.employed=0,i.citizens=0,i.money=0,i.months=0,i.floors=[],n=function(){var e;return e=i.floors[0],e.length<l[i.mode]?e.push(1):i.floors.unshift([1])},c=function(){var e;return e=i.floors[0],1===e.length?i.floors.shift():e.shift()},i.display_plus=function(l,a){return i.floors.length<e[i.mode]&&0===l&&++a===i.floors[0].length},i.display_minus=function(l,a){return null!=i.floors[l]?i.floors.length===e[i.mode]||0===l&&a===i.floors[0].length-2||l>0&&++a===i.floors[l].length:void 0},i.display_mutator=function(l,a){return 0===l?!0:i.floors.length<e[i.mode]?++a===i.floors[l].length&&1===i.floors[--l].length:l===e[i.mode]},i.toggle_bedroom=function(l,a){var o,t;return o=i.floors[i.floors.length-1],t=i.floors[l].length,0===l?a===t-1&&i.floors.length<e[i.mode]?n():c():a===t-1?c():void 0},i.random_reverse=function(e){return Math.random()>.5?e.reverse():e},i.toggleCreator=function(e){var l,a,n;i.mode=e,a=i.creating;for(l in a)n=a[l],l===e?i.creating[e]=!i.creating[e]:i.creating[l]=!1;return"residential"===e?i.floors=[[1,1]]:"commercial"===e?i.floors=[[1,1,1,1]]:"industrial"===e?i.floors=[[1,1,1]]:void 0},i.create_industrial_tile=function(){var e,l;return e={},l=0,i.floors.forEach(function(e){return l+=e.length}),e.jobs=l,e.available=e.jobs,e.decay=Math.ceil(e.jobs/4),e.type="industrial",console.log("industrial",e),e},i.create_commercial_tile=function(){var e,l;return e={},l=0,i.floors.forEach(function(e){return l+=e.length}),e.jobs=l,e.available=e.jobs,e.decay=Math.ceil(e.jobs/4),e.type="commercial",console.log("commercial",e),e},i.create_residential_tile=function(){var e,l;return e={},l=0,i.floors.forEach(function(e){return l+=e.length}),1===i.floors[0].length&&(l+=1),e.people=l,e.employed=0,e.type="residential",e},i.processors={residential:function(e,l){var a,n,o;return("commercial"===l.type||"industrial"===l.type)&&(o=e.people-e.employed,o=e.decay>o?o:e.decay,o>0&&l.available>0)?(n=l.available>o?l.available:o,a=Math.round(n>o?o:n),e.employed+=a,l.available-=a,i.employed+=a):void 0}},a(function(){var e,l,a,n,o,t,r,s,c,d,u,f;for(12===++i.months&&(i.money+=100*i.employed,i.months=0),s=i.grid,c=[],n=t=0,r=s.length;r>t;n=++t)d=s[n],c.push(function(){var t,r,s,c,g,m,b;for(g=[],o=r=0,t=d.length;t>r;o=++r)e=d[o],f=function(){m=[];for(var e=s=n-3,l=n+3;l>=s?l>=e:e>=l;l>=s?e++:e--)m.push(e);return m}.apply(this),a=function(){b=[];for(var e=c=o-3,l=o+3;l>=c?l>=e:e>=l;l>=c?e++:e--)b.push(e);return b}.apply(this),g.push(null!=e.type?function(){var n,o,t,r;for(t=i.random_reverse(f),r=[],o=0,n=t.length;n>o;o++)u=t[o],r.push(function(){var n,o,t,r,s,c;for(o=i.random_reverse(a),s=[],c=0,n=o.length;n>c;c++)l=o[c],s.push(null!=(null!=(t=i.grid[u])&&null!=(r=t[l])?r.type:void 0)?e.x!==u||e.y!==l?u>=0&&l>=0&&null!=i.processors[e.type]?i.processors[e.type](e,i.grid[u][l]):void 0:void 0:void 0);return s}());return r}():void 0);return g}());return c},5e3),i.toggle=function(e,l){var a,n,o,t,r,s,c,d,u,f,g,m,b,p,v,h,x,y,_,$;a=i["create_"+i.mode+"_tile"]();for(g in a)t=a[g],i.grid[e][l][g]=t;if(null!=a.people&&(i.citizens+=a.people),i.grid[e][l].x=e,i.grid[e][l].y=l,null!=a.decay){for(x=a.decay,$=function(){p=[];for(var l=m=e-x,i=e+x;i>=m?i>=l:l>=i;i>=m?l++:l--)p.push(l);return p}.apply(this),s=function(){v=[];for(var e=b=l-x,i=l+x;i>=b?i>=e:e>=i;i>=b?e++:e--)v.push(e);return v}.apply(this),h=[],c=f=0,u=$.length;u>f;c=++f)_=$[c],n=Math.abs(c-x),h.push(function(){var e,l,a,t;for(t=[],d=l=0,e=s.length;e>l;d=++l)r=s[d],o=Math.abs(d-x),n===x||o===x?y=1:0===n&&0===o||1===n&&0===o||0===n&&1===o?y=x:0===n||0===o?y=0===n?o:n:n>o?y=n/o:o>n?y=o/n:n===o&&(y=1===n&&1===o?x:n),t.push(null!=(null!=(a=i.grid[_])?a[r]:void 0)?null!=i.grid[_][r].decay?i.grid[_][r].decay+=y:i.grid[_][r].decay=y:void 0);return t}());return h}},i.grid=[],d=[],o=t=0;50>=t;o=++t)i.grid.push([]),r=i.grid.length-1,d.push(function(){var e,l;for(l=[],s=e=0;50>=e;s=++e)l.push(i.grid[r].push({}));return l}());return d}])}.call(this),function(){angular.module("simgame").directive("unit",function(){return{require:"ngModel",link:function(e,l,i,a){return a.$validators.integer=function(l,i){if(console.log("modelValue",l,"viewValue",i),"multi"===e.residential_creator.mode){if(parseInt(l)>0&&parseInt(l)<=4)return!0;parseInt(l)<0?e.residential_creator.units=0:parseInt(l)>=4&&(e.residential_creator.units=4)}else if("apartment"===e.residential_creator.mode){if(parseInt(l)>0&&parseInt(l)<=200)return!0;parseInt(l)<0?e.residential_creator.units=0:parseInt(l)>200&&(e.residential_creator.units=200)}else if("single"===e.residential_creator.mode){if(1===parseInt(l))return!0;e.residential_creator.units=1}return!1}}}})}.call(this),function(){angular.module("simgame").run(["$log",function(e){return e.debug("runBlock end")}])}.call(this),function(){angular.module("simgame").config(["$stateProvider","$urlRouterProvider",function(e,l){return e.state("home",{url:"/",templateUrl:"app/main/main.html",controller:"MainController",controllerAs:"main"}),l.otherwise("/")}])}.call(this),function(){angular.module("simgame").constant("moment",moment)}.call(this),function(){angular.module("simgame").config(["$logProvider",function(e){return e.debugEnabled(!0)}])}.call(this),angular.module("simgame").run(["$templateCache",function(e){e.put("app/main/main.html",'<div class="container-fluid"><div class="row"><div class="menu col-md-3"><h1 class="col-xs-12">SimPopulous</h1><div class="stats col-xs-12 col-mg-6 col-lg-4"><i class="fa fa-usd"></i><em>{{ money | number:2 }}</em></div><div class="stats col-xs-12 col-mg-6 col-lg-4"><i class="fa fa-group"></i><em>{{ citizens | number }}</em></div><div class="stats col-xs-12 col-mg-6 col-lg-4"><i class="fa fa-coffee"></i><em>{{ employed | number }}</em></div><div class="tiles col-xs-12"><div ng-click="toggleCreator(\'residential\')" class="tile residential"><i class="fa fa-home fa-2x"></i></div><div ng-click="toggleCreator(\'commercial\')" class="tile commercial"><i class="fa fa-building fa-2x"></i></div><div ng-click="toggleCreator(\'industrial\')" class="tile industrial"><i class="fa fa-industry fa-2x"></i></div><div ng-click="toggleCreator(\'education\')" class="tile education"><i class="fa fa-graduation-cap fa-2x"></i></div><div ng-click="toggleCreator(\'public\')" class="tile public"><i class="fa fa-institution fa-2x"></i></div></div><div class="creators col-xs-12"><div ng-submit="createResidentialTile()" ng-if="creating.residential" class="residential"><h3>Residential</h3><div class="unit-details col-xs-12"><div class="col-xs-8 col-xs-offset-2"><div class="single-house-top fa fa-home fa-5x"></div><div ng-repeat="floor in floors track by $index" ng-init="floor_index = $index" class="beds"><a ng-repeat="bed in floor track by $index" ng-class="{ standard: floor.length == 2, master: floor.length == 1 }" ng-click="toggle_bedroom(floor_index, $index)" class="bed btn btn-default"><i class="fa fa-bed"></i><i ng-class="{ \'fa-plus\': display_plus(floor_index, $index), \'fa-minus\': display_minus(floor_index, $index) }" ng-if="display_mutator(floor_index, $index)" class="fa"></i></a></div><div class="single-house-bottom fa fa-home fa-5x"></div></div><div class="form-group col-xs-12"><label class="control-label col-xs-6">Cost</label><div class="col-xs-6"><p class="form-control-static">${{ cost | number:2 }}</p></div></div></div></div><div ng-submit="createCommercialTile()" ng-if="creating.commercial" class="commercial"><h3>Commercial</h3><div class="office-complex-top fa fa-building fa-5x"></div><div ng-repeat="floor in floors track by $index" ng-init="floor_index = $index" class="floor"><a ng-repeat="desk in floor track by $index" ng-class="{ standard: floor.length == 2, master: floor.length == 1 }" ng-click="toggle_bedroom(floor_index, $index)" class="office btn btn-default"><i ng-class="{ \'fa-plus\': display_plus(floor_index, $index), \'fa-minus\': display_minus(floor_index, $index) }" ng-if="display_mutator(floor_index, $index)" class="fa"></i></a></div><div class="office-complex-bottom fa fa-building fa-5x"></div></div><div ng-submit="createIndustrialTile()" ng-if="creating.industrial" class="industrial col-xs-12"><h3>Industrial</h3><div class="manufacturing-plant-top fa fa-industry fa-5x"></div><div ng-repeat="floor in floors track by $index" ng-init="floor_index = $index" class="line"><a ng-repeat="desk in floor track by $index" ng-class="{ standard: floor.length == 2, master: floor.length == 1 }" ng-click="toggle_bedroom(floor_index, $index)" class="worker btn btn-default"><i class="fa fa-wrench"></i><i ng-class="{ \'fa-plus\': display_plus(floor_index, $index), \'fa-minus\': display_minus(floor_index, $index) }" ng-if="display_mutator(floor_index, $index)" class="fa"></i></a></div><div class="manufacturing-plant-bottom fa fa-industry fa-5x"></div></div><form ng-submit="createEducationTile()" ng-if="creating.education" class="form-horizontal education"><h3>Education</h3><div role="group" aria-label="Education options" class="col-xs-10 col-xs-offset-1 form-group btn-group-vertical"><label ng-model="education_creator.mode" btn-radio="\'elementary\'" uncheckable="" class="btn btn-default">Elementary school</label> <label ng-model="education_creator.mode" btn-radio="\'middle\'" uncheckable="" class="btn btn-default">Middle school</label> <label ng-model="education_creator.mode" btn-radio="\'high\'" uncheckable="" class="btn btn-default">High school</label> <label ng-model="education_creator.mode" btn-radio="\'college\'" uncheckable="" class="btn btn-default">College</label> <label ng-model="education_creator.mode" btn-radio="\'university\'" uncheckable="" class="btn btn-default">University</label></div><button type="submit" class="btn btn-success">Create</button></form><form ng-submit="createPublicTile()" ng-if="creating.public" class="form-horizontal education"><h3>Public</h3><div role="group" aria-label="Public options" class="col-xs-10 col-xs-offset-1 form-group btn-group-vertical"><label ng-model="public_creator.mode" btn-radio="\'firehouse\'" uncheckable="" class="btn btn-default">Firehouse</label> <label ng-model="public_creator.mode" btn-radio="\'police-station\'" uncheckable="" class="btn btn-default">Police station</label> <label ng-model="public_creator.mode" btn-radio="\'hospital\'" uncheckable="" class="btn btn-default">Hospital</label> <label ng-model="public_creator.mode" btn-radio="\'park\'" uncheckable="" class="btn btn-default">Park</label></div><button type="submit" class="btn btn-success">Create</button></form></div></div><div class="game-board col-md-9"><div class="grid"><div ng-repeat="col in grid" class="line"><div ng-repeat="r in col" ng-click="toggle($parent.$index, $index)" class="tile {{ r.type }} {{ r.level }}"></div></div></div></div></div></div>')}]);